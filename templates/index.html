<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>RS Printer</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layui.css') }}" media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>

<blockquote class="layui-elem-quote layui-text">
  远程打印问题：1.只能打印图片和pdf文档 2. 必须选择打印机
</blockquote>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend>选择打印</legend>
</fieldset>

<form class="layui-form" action="" enctype="multipart/form-data">

  <div class="layui-form-item">
    <label class="layui-form-label">选择打印机</label>
    <div class="layui-input-block">
        {% if printerList %}
          <select name="printer" lay-filter="aihao">
              {% for item in printerList %}
            <option value="{{ item }}">{{ item }}</option>
              {% endfor %}
          </select>
        {% else %}
            没有可使用的打印机
       {% endif %}
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">上传文件</label>
    <div class="layui-input-block">
     <button type="button" class="layui-btn" id="test3"><i class="layui-icon"></i>上传文件</button>
        <input type="text" name="filename" id="filename">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">打印方向</label>
    <div class="layui-input-block">
      <input type="radio" name="printfx" value="横向" title="横向" checked="">
      <input type="radio" name="printfx" value="纵向" title="纵向">
    </div>
  </div>

  <div class="layui-form-item">
    <div class="layui-input-block">
      <button type="submit" class="layui-btn" lay-submit="" lay-filter="prt">立即打印</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>

<script src="{{ url_for('static', filename='layui.js') }}" charset="utf-8"></script>
<script>
layui.use(['form', 'upload'], function(){
  var form = layui.form
      ,layer = layui.layer
      ,upload = layui.upload;

  upload.render({ //允许上传的文件后缀
    elem: '#test3'
    ,url: '/upload'
    ,accept: 'file' //普通文件
    ,exts: 'jpg|png|pdf|txt' //只允许上传压缩文件
    ,done: function(res){
      layer.msg(res.filename + '上传成功');
      layui.$("#filename").attr('value', res.msg);
    }
    ,error: function(res){
        layer.msg('上传失败');
      console.log(res)
    }
  });

  //监听提交
  form.on('submit(prt)', function(data){
      console.log(layui.$(data.form).serialize());
             layui.$.ajax({
                 url: '/toprint',
                 type: 'POST',
                 data: layui.$(data.form).serialize(),
                 success: function (info) {
                     if (info.code === 1) {
                         setTimeout(function () {
                             location.href = info.url;
                         }, 1000);
                     }
                     layer.msg(info.msg);
                 }
             });
    return false;
  });
});
</script>

</body>
</html>